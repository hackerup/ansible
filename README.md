# Overview
This repository contains a number of Ansible playbooks (scripts for non-Ansible folks) that can be used to configure remote devices, install offensive security tools, and setup various types of infrastructure (phishing, web redirectors, mail servers, C2 servers).

Ansible is a "software provisioning, configuration management, and application-deployment tool."  It runs on a Unix system, and can be used to remotely manage Unix and Windows systems. Ansible is only installed on the "Server" system, it does not install Ansible agents on the client/target systems.

These playbooks are meant to be modular, they can be used independently or in combnination with each other. The playbooks might not be one size fits all, but thankfully Ansible is pretty easy to understand and you can easily swap, add, or remove tasks to fit your needs. 

Ansible tasks use "modules" that are kind of like wrappers for OS commands, so the playbooks feel very much like writing a bash or batch script executing serial OS commands. If there isn't a module to do what you want you can just perform actions using the "command line."

# Requirements
 * Python 2.7 is required to be installed on the client/target:
   * apt-get install python -y
 * SSH server running on the client/target

Reference this article when following the next steps:  https://www.linode.com/docs/applications/configuration-management/running-ansible-playbooks/

# How to get started
### Install Ansible and dependencies:
1. sudo apt install ansible
2. sudo apt install whois
3. Add Client names and IPs to Ansible "hosts" file:
   * Must match names under the "hosts" area in ansible scripts: i.e. mail, core, redirector, drone
   * sudo vi /etc/ansible/hosts
   
### Pre setup if your client is not configured with an unprivileged user with SSH keys:
1. Generate and record password hash for the new unprivilged user use in .yml files:
   * mkpasswd -m sha-512
2. Disable host key checking:
   * sudo vi /etc/ansible/ansible.cfg
3. sudo apt-get install sshpass
4. Generate ssh keypairs for Clients, annotate paths for .yml files:
   * ssh-keygen

### Initialize playbook variables
* Modify variables in the "vars" section of each Ansible script. 
  * Data that needs to be modified is contained between angle brackets (e.g. <variable_name>).
  * If you are running scripts in series to build a certain infrastructure concept (i.e. phishing server + mail server + web redirector), you will not know all of the variables up front as some of the required information is dependent on a prior script executing. For example, ghostPhish.yml requires the SSL certs generated by webRedirector.yml.

### How to execute playbooks
* Run initial secureSetup.yml Ansible script to configure Clients in a secure state:
  * sudo ansible-playbook --ask-pass -u root secureSetup.yml
* Run secondary Ansible scripts to configure Client for various purposes:
  * sudo ansible-playbook -u <Client_unprivileged_user_name> <script_name>.yml --key-file <path/sshkey_rsa> --ask-become-pass
### For when you rebuild a Client and need to delete old keys:
  * sudo ssh-keygen -f "/root/.ssh/known_hosts" -R clientIp

# SSL Cert Generation Requirements
* SSL certs are generated via letsencrypt. At the time of writing, letsencrypt did not offer wildcard certificates, meaning each subdomain has to be specified when requesting the SSL cert (see webRedirector.yml). Because of this all DNS records need to point to the server (web redirector) running the letsencrypt command requesting the SSL cert, if not letsencryp will error out.
* Make sure to setup DNS records before running the webRedirector.yml script, letsencrypt needs the records to be established in order to make SSL certs. 
  * **ALL RECORDS NEED TO INITIALLY POINT TO WEB REDIRCTOR IP BEFORE GENERATING SSL CERTS**
  * Ensure that the hostnames resolve in DNS before moving forward.
* Make sure to change Hostnames on cloud hosted servers so that reverse DNS is properly configured

# How to setup GoPhish infrastructure:
 1. Run secureSetup.yml on Core Server (server that GoPhish is installed on), Web Redirector, and Mail Server
 2. Run webRedirector.yml on Web Redirector
 3. Run mailServer.yml on Mail Server
 4. Run GoPhish.yml/GhostPhish.yml on Core
